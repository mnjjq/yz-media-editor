---
inclusion: always
---

# 音视频剪辑应用架构规范

## 项目概述
这是一个基于 Electron + React + Rust 的音视频剪辑处理应用，采用 monorepo 架构。

## 核心架构原则

### 1. 分层职责清晰
- **Electron**: 仅作为"壳 + 调度"，负责窗口管理、IPC通信、文件系统权限
- **React**: 负责UI渲染和用户交互，不处理业务逻辑
- **editor-core**: 项目灵魂，纯TypeScript编辑器领域模型
- **Rust**: 性能核心，专门处理音视频的底层操作

### 2. 严格的边界控制
- ❌ **禁止**: Electron主进程写重逻辑（时间轴算法、音视频处理、业务规则）
- ❌ **禁止**: React直接调用Rust
- ❌ **禁止**: Electron直接调用Rust
- ✅ **必须**: 通过media-bridge作为JS↔Rust的唯一入口

## 目录结构规范

```
video-editor-monorepo/
├─ apps/                    # 可运行应用
│  ├─ desktop/             # Electron桌面应用
│  └─ playground/          # 测试工具（可选）
├─ packages/               # 共享能力
│  ├─ ui/                  # React UI组件库
│  ├─ editor-core/         # 编辑器领域模型（纯TS）
│  ├─ media-bridge/        # JS↔Rust桥接层
│  └─ shared/              # 通用工具&类型
├─ native/                 # Rust原生层
│  ├─ media-engine/        # 音视频处理引擎
│  └─ media-node/          # NAPI/C-ABI封装
└─ configs/                # 统一配置
```

## 数据流规范

标准数据流向：
```
用户操作 → React UI → editor-core → Electron IPC → media-bridge → Rust media-engine
```

结果返回：
```
Rust结果 → media-bridge → Electron IPC → editor-core → React UI → 用户界面
```

## 开发规范

### Electron开发
- 主进程只处理系统级操作
- 复杂逻辑必须下沉到其他层
- 避免在主进程中实现业务逻辑

### React开发
- 专注UI组件和用户交互
- 状态管理使用Zustand或Redux
- 不直接处理音视频数据

### editor-core开发
- 保持纯TypeScript，无外部依赖
- 实现时间轴、轨道、片段等核心模型
- 提供Command模式支持撤销/重做

### Rust开发
- 专注性能敏感的音视频处理
- 使用FFmpeg/GStreamer进行解码
- 通过NAPI暴露接口给JavaScript

### 跨语言通信
- 所有JS↔Rust通信必须通过media-bridge
- 使用Promise/Stream模式处理异步操作
- 确保类型安全和错误处理

## 扩展规范
- 新增AI功能：创建`native/ai-engine`
- 新增插件系统：创建`packages/plugin-api`
- 保持架构层次清晰，避免跨层直接调用